<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>个人设置</title>
		<meta name="viewport" content="initial-scale=1, maximum-scale=1">
		<link rel="shortcut icon" href="/favicon.ico">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--ui包-->
		<link rel="stylesheet" href="../../../css/sm.css">
		<link rel="stylesheet" href="../../../css/layout.css">
	</head>
	<body>
		<div class="page-group">
			<div class="page page-current">
			 <div class="list-block">
			      <ul>
			        <li class="item-content">
			            <div class="item-inner">
			              <div class="item-title">微信头像</div>
			              <div class="userobj userImg" style="margin: 0;" id="userHead"><img src="../../../images/defaultHead.jpg"></div></div>
			        </li>
			        <li class="item-content">
			            <div class="item-inner">
			              <div class="item-title">微信昵称</div>
			              <div class="item-after" id="nickname">布鲁斯贵伊</div>
			            </div>
			        </li>
			        <li class="item-content">
			            <div class="item-inner">
			              <div class="item-title">用户ID</div>
			              <div class="item-after" id="userId">230293844</div>
			            </div>    
			        </li>
			        <li class="item-content item-link" id="toMobPage">
			            <div class="item-inner" >
			              <div class="item-title">手机号</div>
			              <div class="item-after" id="userMob">15002291581</div>
			            </div>
			        </li>
			         <li class="item-content item-link" id="toPSWPage">
			            <div class="item-inner">
			              <div class="item-title">密码</div>
			              <div class="item-after">修改密码</div>
			            </div>
			        </li>
			        <li id='Certification' class="item-content">
								<div class="item-inner">
									<div class="item-title">用户认证</div>
									<div class="item-after">已认证</div>
								</div>
							</li>
			        <li class="item-content">
			            <div class="item-inner">
			              <div class="item-title">孩子姓名</div>
			              <div class="item-after" id="userName">柳爽孩子</div>
			            </div>
			        </li>
			         <li class="item-content">
			            <div class="item-inner">
			              <div class="item-title">孩子生日</div>
			              <div class="item-after" id="userbirthday">1992-07-22</div>
			            </div>
							</li>
							<li class="item-content item-link">
								<div class="item-inner">
									<div class="item-title">家长身份</div>
										<div class=" item-after" id="">
											<input type="text" id="nowsRelation" readonly="" relation value="选择亲子关系" style="text-align:right;margin-top: -.46rem;">
										</div>
								</div>
							</li>
			      </ul>
			   </div>
			   <div class="content-block">
		          <a href="javascript:void(0)" class="button button-fill external" id="quit">退出登录</a>
		  	   </div>
			</div>
		</div>
		
		<!--修改手机号-->
		<div class="page" id='mobile'>
		  <div class="content">
		     	<div class="list-block">
				    <ul>
				      <li>
				        <div class="item-content">
				          <div class="item-inner">
				            <div class="item-title label">密码</div>
				            <div class="item-input">
				              <input type="password" placeholder="请输入登录密码" id="pswFmob" name="mobile">
				            </div>
				          </div>
				        </div>
				      </li>
				   </ul>
			    </div>	      
			    <div class="list-block">
					 <ul>
					     <li>
					        <div class="item-content">
					          <div class="item-inner">
					            <div class="item-title label">新手机号</div>
					            <div class="item-input">
					              <input type="tel" placeholder="请输入新手机号码" id="mobFmob" name="mobile">
					            </div>
					          </div>
					        </div>
					      </li>
					      <li>
					        <div class="item-content" style="background:#fff;">
					          <div class="item-inner">
					            <div class="item-title label">验证码</div>
					            <div class="item-input">
					              <input type="tel" placeholder="请输入验证码" id="codeFmob">
					              <div class="getCode" id="getCode">获取验证码</div>
					            </div>
					          </div>
					        </div>
					      </li>
						</ul>
			    </div>
		        <div class="content-block">
					<a href="javascript:void(0)" class="button button-fill external" id="editMob">修改手机</a>
					<a class="button close-popup back" style="margin-top:1rem">返回</a>
				</div>
		  </div>
		</div>
		<!-- 修改该手机号 End-->
		
		<!--修改密码-->
		<div class="page" id='password'>
		  <div class="content">
		     	<div class="list-block">
				    <ul>
				      <li>
				        <div class="item-content">
				          <div class="item-inner">
				            <div class="item-title label">旧密码</div>
				            <div class="item-input">
				              <input type="password" placeholder="请输入登录密码" id="oldPsw" name="mobile">
				            </div>
				          </div>
				        </div>
				      </li>
				   </ul>
			    </div>	      
			    <div class="list-block">
				    <ul>
				     <li>
				        <div class="item-content">
				          <div class="item-inner">
				            <div class="item-title label">新密码</div>
				            <div class="item-input">
				              <input type="password" placeholder="请输入新密码" id="newPsw" name="mobile">
				            </div>
				          </div>
				        </div>
				      </li>
				      <li>
				        <div class="item-content" style="background: #fff;">
				          <div class="item-inner">
				            <div class="item-title label">新密码</div>
				            <div class="item-input">
				              <input type="password" placeholder="请再次输入新密码" id="reNewPsw">
				            </div>
				          </div>
				        </div>
				      </li>
				    </ul>
			    </div>
		        <div class="content-block">
					<a href="javascript:void(0)" class="button button-fill external" id="editPsw">修改密码</a>
					<a class="button close-popup back" style="margin-top:1rem">返回</a>
				</div>
		  </div>
		</div>
		<!-- 修改该手机号 End-->
	</body>
</html>
<script src='../../../js/zepto.min.js'></script>
<script src='../../../js/sm.min.js'></script>
<script src='../../../js/config.js'></script>
<script type="text/javascript">


		$("#nowsRelation").picker({
				toolbarTemplate: '<header class="bar bar-nav">\
				<button class="button button-link pull-right close-picker">确定</button>\
				<h1 class="title">请选择亲子关系</h1>\
				</header>',
				cols: [
					{
						textAlign: 'center',
						values: ['父亲', '母亲', '爷爷', '奶奶', '外公', '外婆', '其他']
					}
				],
				onClose: function () {
						//alert(1);
					switch($('#nowsRelation').val()){
						case '父亲' : $('#nowsRelation').attr('relation','0'); break;
						case '母亲' : $('#nowsRelation').attr('relation','1'); break;
						case '爷爷' : $('#nowsRelation').attr('relation','2'); break;
						case '奶奶' : $('#nowsRelation').attr('relation','3'); break;
						case '外公' : $('#nowsRelation').attr('relation','4'); break;
						case '外婆' : $('#nowsRelation').attr('relation','5'); break;
						case '其他' : $('#nowsRelation').attr('relation','6'); break;
					}
				}
		});



	//点击返回按钮返回设置首页
	$(".back").on("click",function() {
			$.router.back();
	})
	//更新本地状态
	// getData("../../../api/userInfo", {token:sessionStorage.token,da:Math.random()},function(result){
	// 		if(result.code=="0"){
	// 			sessionStorage.baseUser=JSON.stringify(result.baseUser);
	// 			sessionStorage.baseInfo=JSON.stringify(result.baseWeixinInfo);
				
	// 			 var baseWeixinInfo=JSON.parse(sessionStorage.baseInfo);
	// 			 var baseUser=JSON.parse(sessionStorage.baseUser);
				 
	// 			 var idLength=parseInt(baseUser.id.toString().length);
	// 			 switch(idLength)
	// 			 {
	// 			 case 1:
	// 				var idhtml="0000";
	// 			   break;
	// 			 case 2:
	// 				var idhtml="000";
	// 			   break;
	// 			 case 3:
	// 					var idhtml="00";
	// 				   break;
	// 			 default:
	// 				var idhtml="0";
	// 			 }
				 
	// 			 if(baseUser.birthday==""||baseUser.birthday==null){
	// 				 var birthdayHtml="--";
	// 			 }else{
	// 				 var birthdayHtml=baseUser.birthday;
	// 			 }
				 
	// 			 //认证状态
	// 		   if(result.baseUser.isCertification==1){//用户-是否认证
	// 				  $("#Certification").text("已认证").closest("a").attr("href","");
	// 			      var html='<div class="item-inner">'+
	// 					          '<div class="item-title">用户认证</div>'+
	// 					          '<div class="item-after">已认证</div>'+
	// 					        '</div>';
	// 				  $("#Certification").addClass("item-content").html(html);	
	// 				  $("#userbirthday").text(birthdayHtml);
	// 			   }else{
	// 			     var html='<a href="./authentication.html" class="item-link item-content external">'+
	// 						      '<div class="item-inner">'+
	// 						      '<div class="item-title">用户认证</div>'+
	// 						      '<div class="item-after">未认证</div>'+
	// 						    '</div>'+
	// 						  '</a>';
	// 				  $("#Certification").html(html);
	// 				  $("#userName").parent().parent().hide();
	// 				  $("#userbirthday").text(birthdayHtml).parent().parent().hide();
	// 			   }
				 
	// 		       $("#userId").text(idhtml+baseUser.id);//用户-id
	// 			   $("#userHead img").attr("src",baseWeixinInfo.headimgurl);//用户-头像
	// 			   $("#nickname").html(baseWeixinInfo.nickname);//用户-微信昵称
	// 			   $("#userName").text(baseUser.name);//用户-姓名
	// 			   $("#userId").text(idhtml+baseUser.id);//用户-id
	// 			   $("#userMob").text(baseUser.mobile);//用户-手机号
				 
				   
	// 		}else{
	// 			$.alert(result.msg);
	// 		}
	// }); 

  
   if(window.location.hash!==""){
		window.location="set.html";
   }

   
   //实名认证
   $(document).on("pageInit", function(e, pageId, $page) {
	   if(pageId == "authentication") {
		   $("#toBind").click(function(){
				var val=$.trim($("#userName").val()),code=$.trim($("#userCode").val());
				if(val==""){
					$.alert("孩子姓名不能为空！");
					return false
				}
				if(code==""){
					$.alert("孩子身份证号不能为空！");
					return false
				}
				if(code.length!==18){
					$.alert("孩子身份证号格式不正确！");
					return false
				}
				var data={
						token:sessionStorage.token,
						name:val,
						certificateCode:code,
				}
				getData("../../../api/recruit/identification",data,function(result){
					if(result.success=="true"){
						$.alert("认证成功！",function(){window.location.href="parent.html";});
						setTimeout(function(){window.location.href="parent.html";},600);
					}else{
						$.alert(result.msg);
					}
				});
		   
	   });
	   }
	});
   
   //设置手机号
   $("#toMobPage").click(function(){
	   $.router.loadPage("#mobile");
	});
   //设置密码editPSW
    $("#toPSWPage").click(function(){
	   $.router.loadPage("#password");
	});
    //修改密码
    $("#editPsw").click(function(){
	    	var  psw=$("#newPsw").val(),
			reNewPsw=$("#reNewPsw").val(),
			  oldPsw=$("#oldPsw").val();
			if(oldPsw==""){
				$.alert("请输入旧密码！");
				return false
			}
			if(psw==""){
				$.alert("请输入新密码！");
				return false
			}
			if(reNewPsw==""){
				$.alert("请确认新密码！");
				return false
			}
			
			if(reNewPsw!==psw){
				$.alert("两次密码输入不一致！");
				return false
			}
			
			var parameter={
					token:sessionStorage.token,
					//用户登录时获取的token
					password:oldPsw,
					//用户密码
					newPassword:psw,
					//新密码
					reNewPassword:reNewPsw,
					//确认新密码
			}
		
			//修改密码
		 	getData("../../../api/weixinModifyPassword", parameter,function(res){
				if(res.code=="0"){
					
					$.alert("密码修改成功！",function(){
						//修改密码后如果token失效，必须重新登录
						//window.location.href="../login_byPSW.html?id="+userId;
						$.router.back("set.html")
						});
					setTimeout(function(){
						//window.location.href="../login_byPSW.html?id="+userId;
						$.router.back("set.html")
					},600);
				}else{
					$.alert(res.msg);
				}
			},"POST");  
 	});
    
    //修改手机号
    $("#editMob").click(function(){
    	
    	var  psw=$("#pswFmob").val(),
		     mob=$("#mobFmob").val(),
		 mobCode=$("#codeFmob").val();
    	
		if(psw==""){
			$.alert("请输入密码！");
			return false
		}
		if(mob==""){
			$.alert("请输入手机号！");
			return false
		}
		
		if(mobCode==""){
			$.alert("请输入获取的验证码！");
			return false
		}
		
		var parameter={
				token:sessionStorage.token,
				//用户登录时获取的token
				password:psw,
				//用户密码
				mobile:mob,
				//手机号
				validateCode:mobCode,
				//验证码
		}
	
		//修改密码
	 	getData("../../../api/weixinModifyMobile", parameter,function(res){
			if(res.code=="0"){
				$.alert("手机号修改成功！",function(){
					//修改密码后如果token失效，必须重新登录
					$.router.back("set.html")
					});
				setTimeout(function(){
					$.router.back("set.html")
				},2000);
			}else{
				$.alert(res.msg);
			}
		},"POST");  
	});
    
    //修改手机号获取验证码
	$("#getCode").click(function(){
			var val=$("#mobFmob").val();
			if(val==""){
				$.alert("手机号不能为空！");
				return false
			}
			//获取验证码
			getData("../../../api/sendValidateCode4Register", {mobile:val},function(res){
				if(res.code!=="0"){
					$.alert(res.msg);
				}
			})
	});
    
    //退出登录
    $("#quit").click(function(){
    	userQuit();
    	window.location="../login_byPSW.html"
    });
</script>
 